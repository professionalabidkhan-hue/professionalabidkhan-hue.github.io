<!DOCTYPE html>
<html lang="en">
<head>
    <title>Master Roster | Abid Khan Hub</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; padding: 40px; }
        .roster-card { background: #1e293b; border-radius: 12px; padding: 20px; border: 1px solid #334155; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: left; border-bottom: 2px solid #3b82f6; padding: 10px; color: #94a3b8; }
        td { padding: 12px; border-bottom: 1px solid #334155; }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .trainer { background: #8b5cf6; }
        .student { background: #10b981; }
        .whatsapp-btn { color: #25d366; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <div class="roster-card">
        <h2>Master Hub: Registered Members</h2>
        <table id="rosterTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Dept/Focus</th>
                    <th>WhatsApp</th>
                    <th>Registration Date</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
    </div>

    <script>
        // SECURITY SENTINEL
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.onkeydown = function(e) {
            if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) || (e.ctrlKey && (e.keyCode == 85 || e.keyCode == 83))) return false;
        };

        // AUTO-LOAD DATA FROM MONGODB
        async function loadRoster() {
            try {
                const response = await fetch('/api/get-registrations');
                const data = await response.json();
                const tableBody = document.getElementById('tableBody');
                
                tableBody.innerHTML = data.map(user => `
                    <tr>
                        <td><strong>${user.name}</strong><br><small>${user.email}</small></td>
                        <td><span class="badge ${user.role}">${user.role.toUpperCase()}</span></td>
                        <td>${user.department || 'N/A'}</td>
                        <td><a href="https://wa.me/${user.whatsapp}" class="whatsapp-btn" target="_blank">ðŸ’¬ ${user.whatsapp}</a></td>
                        <td>${new Date(user.joined_at).toLocaleDateString()}</td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error("Master Roster Error:", err);
            }
        }

        loadRoster();
    </script>
</body>
</html>
