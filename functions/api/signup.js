export async function onRequest(c){const{request:r,env:e}=c;const h={"Content-Type":"application/json","Access-Control-Allow-Origin":"*"};if(r.method==="OPTIONS")return new Response(null,{status:204,headers:h});try{const d=await r.json();if(!e.DB)return new Response(JSON.stringify({error:"DB Missing"}),{status:500,headers:h});await e.DB.prepare("INSERT INTO users (name,email,whatsapp,password,role,department,created_at) VALUES (?,?,?,?,?,?,?)").bind(d.name,d.email,d.whatsapp||"",d.password,d.role||"student",d.department||"IT",new Date().toISOString()).run();return new Response(JSON.stringify({success:true}),{status:200,headers:h});}catch(err){return new Response(JSON.stringify({error:err.message}),{status:500,headers:h});}}// Last deploy: Sun Jan 18 15:26:23 UTC 2026
